using UnityEngine;
using System.Collections.Generic;

namespace VoxelLUT {

    /**
     * Abstract class which all block rendering types will
     * extend. Has some default helper functionality and forces
     * blocks to implement certain functions.
     */
    public abstract class BlockVisual {
        public abstract int[] Triangles { get; }

        /**
         * Fill the provided array with triangle data
         */
        public void FillTriangles(List<int> tris, int offset) {
            int[] triangles = Triangles;
            int len = triangles.Length;

            if (len == 0) {
                return;
            }

            for (int i = 0; i < len; i++) {
                tris.Add(triangles[i] + offset);
            }
        }

        /**
         * Get the number of triangles that is being generated by this
         * particular block
         */
        public int Count {
            get {
                return Triangles.Length;
            }
        }

        /**
         * Quick index accessor as an array
         */
        public int this[int index] { 
            get {
                return Triangles[index];
            }
        }

        /**
         * Can be used to quickly visualize the triangles as Gizmos. Only
         * available in Editor mode. Function will be empty once code has been built
         */
        public void OnDebug() {
#if UNITY_EDITOR
            Color oldColor = Gizmos.color;
            Gizmos.color = Color.blue;

            int[] tris = Triangles;

            for (int i = 0; i < tris.Length; i+=3) {
                Gizmos.DrawLine(Block.Get(tris[i]), Block.Get(tris[i + 1]));
                Gizmos.DrawLine(Block.Get(tris[i + 1]), Block.Get(tris[i + 2]));
                Gizmos.DrawLine(Block.Get(tris[i + 2]), Block.Get(tris[i]));
            }

            Gizmos.color = Color.green;

            for (int i = 0; i < tris.Length; i ++) {
                Gizmos.DrawSphere(Block.Get(tris[i]), 0.02f);
            }

            Gizmos.color = oldColor;
#endif
        }
    }
}
